# SPA feature inventory and API alignment

## Feature coverage by SPA view and shared stores
- **Login / Register view**: handles session bootstrapping, credential validation, and seeds session defaults such as timezone, default priority, highlighting rules, and text expanders after authentication. These values should populate an auth/user store so they are available before routing to task screens. Registration also initializes default colors, line rules, date formats, and text expanders for new users.【F:login.php†L7-L71】【F:register.php†L14-L68】
- **Active tasks view**: fetches incomplete tasks ordered by due date and priority, renders due labels based on the user’s timezone, and surfaces priority text, star toggles, hashtags, and a responsive search/filter bar. A tasks store should hold the task list plus per-task hashtag assignments and starred state so the SPA can drive list rendering, search, and optimistic star updates without page reloads.【F:index.php†L10-L90】【F:index.php†L136-L200】
- **Completed tasks view**: lists done tasks with due labels, priorities, and hashtags, and offers bulk delete. Reuse the same tasks store with a completed slice for parity and to keep hashtag lookups consistent across filters.【F:completed.php†L10-L138】
- **Hashtags manager view**: modal-driven CRUD that loads user hashtags with usage counts and supports create, rename, and delete actions. A hashtags store should expose the tag catalog and usage metadata to both the manager and task composer/editors.【F:manage_hashtags.php†L27-L90】【F:index.php†L123-L135】
- **Settings view**: updates user profile (username/password), timezone/location, default priority, color themes, capitalization behavior, line rules, date formats, and text expanders. A user preferences store should track these values so task and editor components can react to changes immediately (e.g., timezone-sensitive due labels).【F:settings.php†L12-L220】

## API contracts for SPA parity
- **Create task** (`POST add_task.php`): accepts `description`; server derives `due_date` for “today” using the user’s timezone and applies the user’s default priority. Returns JSON with `id`, normalized `description`, `due_date`, computed `due_label`/`due_class`, `priority` plus label/class, `starred`, and extracted `hashtags`.【F:add_task.php†L12-L104】
- **Update task (full edit)** (`POST task.php?id`): accepts `description`, optional `due_date`, `details`, `priority`, `done`, `starred`; normalizes priority bounds, writes changes, and syncs hashtags derived from description/details. Responds with `status`, updated hashtag list for the task, and the full user hashtag catalog (for suggestions). Use this for marking complete/incomplete as well.【F:task.php†L48-L78】
- **Update task metadata (quick actions)** (`POST update_task_meta.php`): accepts task `id` plus optional `priority` and `due_shortcut` (`today`, `tomorrow`, `next-week`, `clear`, or `YYYY-MM-DD`). Server recalculates due labels with the user’s timezone and returns updated `due_date`, `due_label`/`due_class`, and priority with label/class. Rejects invalid IDs or empty change sets with 400/405 responses.【F:update_task_meta.php†L4-L160】
- **Toggle star** (`POST toggle_star.php`): accepts `id` and boolean-ish `starred`; persists and returns normalized `starred` state. Suitable for optimistic UI with background retries.【F:toggle_star.php†L4-L25】
- **Delete task** (`GET delete_task.php?id` or fetch with JSON accept header): deletes the task for the current user and returns `{'status':'ok'}` for JSON callers; falls back to redirect for legacy pages. Completed-task bulk delete uses `POST delete_completed.php` to clear all done items.【F:delete_task.php†L9-L32】【F:delete_completed.php†L1-L14】
- **Hashtag CRUD** (`GET/POST manage_hashtags.php`): `GET` returns `hashtags` with usage counts. `POST` `action` may be `create` (name), `rename` (id, name), or `delete` (id); responses include refreshed hashtag lists and meaningful HTTP status codes for validation errors or conflicts. Task creation/editing extracts hashtags from text and maintains task↔hashtag links accordingly.【F:manage_hashtags.php†L27-L89】【F:hashtags.php†L12-L119】
- **User settings** (`POST settings.php`): accepts username, optional password, timezone/location, default priority, custom colors, capitalization toggle, line rules JSON, date formats, and text expanders JSON; updates both the database and session mirrors so subsequent calls use the new defaults (e.g., timezone for due calculations).【F:settings.php†L27-L104】

## Data and store alignment
- **Shared stores**: Auth/user store (session-bound identity and preferences), tasks store (active/completed collections with metadata, hashtags, and stars), and hashtags store (catalog + usage). These align to the PHP flows that hydrate session defaults on login and reuse hashtag mappings across pages.【F:login.php†L23-L33】【F:index.php†L10-L20】【F:manage_hashtags.php†L27-L50】
- **Priority and due-date semantics**: Priority is an integer 0–3 with associated labels and custom text classes; due labels use timezone-aware comparisons to output Overdue/Today/Tomorrow/Later plus contextual badge classes. Stores should keep both raw values and display metadata for offline/optimistic rendering.【F:index.php†L10-L90】【F:update_task_meta.php†L105-L159】
- **Timezone/location behavior**: Timezone defaults to session `location` and falls back to stored user preference; date calculations for task creation, due shortcuts, and due labeling all depend on it. SPA should keep timezone in the user store and reuse it for client-side previews while deferring authoritative labels to the API.【F:add_task.php†L17-L40】【F:update_task_meta.php†L45-L88】【F:settings.php†L89-L104】
- **Hashtag relationships**: Tasks auto-extract hashtags from description/details and keep many-to-many mappings; hashtag CRUD maintains unique, normalized tags and returns usage counts so the SPA can display availability and prevent duplicates. Sync hashtags after any task text change to mirror server behavior.【F:task.php†L69-L78】【F:hashtags.php†L55-L119】

## Styling and responsive dependencies to port into SPA shell
- The PHP UI relies on first-party vanilla CSS and lightweight JavaScript for layout, offcanvas navigation, forms, badges, responsive grids, and utility classes across login, tasks, completed, and settings pages; SPA shell should mirror the same tokens to preserve look-and-feel.【F:README.md†L3-L15】【F:index.php†L35-L200】【F:completed.php†L31-L144】【F:settings.php†L108-L220】
- Custom inline styles define task grid layouts, search pill interactions, hashtag manager cards, priority/due badges, and color pickers; mirror these tokens or migrate them into SPA-scoped styles to maintain parity on mobile and desktop breakpoints.【F:index.php†L38-L200】【F:completed.php†L38-L144】【F:settings.php†L108-L220】
